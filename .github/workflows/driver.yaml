run-name: Terraform Workflow Driver
on: 
  pull_request:
    paths:
      - 'terraform/**'
      - '.github/workflows/workflow1.yaml'

permissions:
  pull-requests: write # write permission in order to add comments for terraform output
  id-token: write # write permission is required for az login
      
jobs:
  run1:
    uses: ./.github/workflows/workflow1.yaml
    with:
      working-dir: "terraform/proj1"
      terraform-version: "1.7.3"
      environment: development
  fail-validation:
    uses: ./.github/workflows/workflow1.yaml
    with:
      working-dir: "terraform/fail-validation"
      terraform-version: "1.7.3"
      environment: development
  dev-scenario:
    uses: ./.github/workflows/workflow1.yaml
    with:
      working-dir: "terraform/proj1"
      terraform-version: "1.7.3"
      environment: development
  prod-scenario:
    uses: ./.github/workflows/workflow1.yaml
    needs: [dev-scenario]
    with:
      working-dir: "terraform/proj1"
      terraform-version: "1.7.3"
      environment: production
    